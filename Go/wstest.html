<!DOCTYPE html>
<html style="height:100%;">
	<head>
		<title>Goliath Chat</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.1/slate/bootstrap.min.css" rel="stylesheet">
		<script type="text/javascript">
			$(function() {
					var conn;
					var log = $("#chatBackground");
					var loginarea = $("#loginbox");
					var chatarea = $("#chatarea");
					var inpBox = $("#chatInput");
					var regbox = $("#registerbox");
					var iregbut = $("#registerButton");
					var cancreg = $("#cancelRegisterButton");

					function appendLog(msg) {
					log.append("<p class='msg'>" + msg + "</p>");
					}

					function addMess(user, mess) {
					log.append("<p class='msg'><b>"+user+"<br>"+mess+"</p>");
					}
					$("html").resize(function() {
							log.height(html.height() - inpBox.height())
						});
					$("#loginButton").click(function() {
						conn.send("login");
						conn.send($("#inputServer").val());
						conn.send($("#inputUsername").val());
						conn.send($("#inputPassword").val());
						loginarea.hide(500);
						chatarea.show(500);
						});

					cancreg.click(function() {
							regbox.hide(300);
							loginarea.show(300);
							});
					iregbut.click(function() {
							regbox.show(300);
							loginarea.hide(300);
							});
					$("#form").submit(function() {
							if (!conn) {
							return false;
							}
							if (!msg.val()) {
							return false;
							}
							conn.send(msg.val());
							msg.val("");
							return false
							});

					inpBox.keyup(function(event){
							if(event.keyCode == 13) {
							conn.send(inpBox.val());
							inpBox.val("");
							}
							});
					if (window["WebSocket"]) {
						loginarea.css('height', '300px');
						chatarea.hide();
						regbox.hide();

						conn = new WebSocket("ws://127.0.0.1:8080/ws");
						conn.onclose = function(evt) {
							appendLog("<p><b>Connection closed.</b></p>")
						};
						conn.onmessage = function(evt) {

							var char = ':';
							var str = evt.data;
							var user = str.slice(0, str.indexOf(char));
							var mess = str.slice(str.indexOf(char) + 1);
							addMess(user, mess);
							log.scrollTop(log.height())
						};
					} else {
						appendLog($("<p><b>Your browser does not support WebSockets.</b></p>"))
					}
			});

</script>

	</head>
	<body style="height:100%;">
		<div id="loginbox" align="center">
			<div class="control-group">
				<label class="control-label" for="inputUsername">Username</label>
				<div class="controls">
					<input type="text" id="inputUsername" placeholder="Username">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="inputPassword">Password</label>
				<div class="controls">
					<input type="password" id="inputPassword" placeholder="Password">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="inputServer">Server</label>
				<div class="controls">
					<input type="text" id="inputServer" placeholder="Server IP">
				</div>
			</div>
			<div class="control-group">
				<div class="controls">
					<button id="loginButton" class="btn">Login </button>
					<button id="registerButton" class="btn">Register </button>
				</div>
			</div>
			<div class="alert alert-error" id="loginUPError"style="visibility: hidden;">
				<button type="button" class="close" data-dismiss="alert" visibility="hidden">&times;</button>
				<strong>Login Error!</strong> Username or Password were incorrect.
			</div>
			<div class="alert alert-error" id="loginServerError"style="visibility: hidden;">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<strong>Server Error!</strong> Server not found.
			</div>
		</div>
		<div id="registerbox" align="center">
			<div class="control-group">
				<label class="control-label" for="registerUsername">Username</label>
				<div class="controls">
					<input type="text" id="registerUsername" placeholder="Username">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="registerPassword">Password</label>
				<div class="controls">
					<input type="password" id="registerPassword" placeholder="Password">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="registerPasswordConfirm">Password</label>
				<div class="controls">
					<input type="password" id="registerPasswordConfirm" placeholder="Confirm Password">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="registerServer">Server</label>
				<div class="controls">
					<input type="text" id="registerServer" placeholder="Server IP">
				</div>
			</div>
			<div class="control-group">
				<div class="controls">
					<button type="submit" class="btn" id="submitRegisterButton">Register</button>
					<button type="submit" class="btn" id="cancelRegisterButton">Cancel</button>
				</div>
			</div>
			<div class="alert alert-error" style="visibility: hidden;"id="registerPassError">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<strong>Password Error!</strong> Passwords must be the same.
			</div>
			<div class="alert alert-error" id="registerServerError"style="visibility: hidden;">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<strong>Server Error!</strong> Server not found.
			</div>
			<div class="alert alert-error" id="registerUserError"style="visibility: hidden;">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<strong>Username Registration Error!</strong> Username is already registered on this server.
			</div>
		</div>
		<div id="chatarea" style="height:100%; width:95%; position: relative;">
			<div style="width:100%; height:70%; overflow:auto; padding:10px;" id="chatBackground">
			</div>
			<input style="min-width:90%; position:absolute; bottom:0; left:5px;" type="text" id="chatInput" />
		</div>
	</body>
</html>
